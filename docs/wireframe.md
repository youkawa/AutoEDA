# AutoEDA ワイヤーフレーム v2 (実装同期版)

> 対象: `apps/web` の現行 UI。サイドバー + コンテンツ領域という最低限の構成に合わせ、各ページの Lo-Fi ワイヤーフレームを更新する。アップロード UI など未実装要素はバックログとして明記する。

---

## 0. 共通レイアウト / AppLayout

```
┌──────────────────────────────────────────────┐
│ Sidebar (220px)               TopBar (sticky)  │
│ ┌──────────────┐ ┌──────────────────────────┐ │
│ │ AutoEDA      │ │ [H1] Title               │ │
│ │ - Home       │ │ [Actions: Help / Settings]││
│ │ - Datasets   │ └──────────────────────────┘ │
│ │ - Settings   │ ┌──────────────────────────┐ │
│ └──────────────┘ │ Main Content (flex:1)    │ │
│                   │  Padding: 24             │ │
│                   └──────────────────────────┘ │
└──────────────────────────────────────────────┘
```

- サイドバーに現在地ハイライト、TopBar にページタイトルと右上アクション。
- 全ページで見出し (`<h1>`) を先頭に配置。

---

## 1. Home (`/`)

```
┌ Main ───────────────────────────────────────┐
│ [H1] Home                                   │
│  データをアップロードしてEDAを開始できます。 │
│  左のメニューから Datasets へ進んでください。│
└───────────────────────────────────────────┘
```

*バックログ*: CSV ドロップ領域とアップロードボタンを追加。

---

## 2. Datasets (`/datasets`)

```
┌ Main ───────────────────────────────────────┐
│ [H1] Datasets                               │
│  • ds_xxx.csv  [Button variant="ghost"]    │
│  • ds_yyy.csv  [Button variant="ghost"]    │
└───────────────────────────────────────────┘
```

- `Button` を押下すると `/eda/:datasetId` へ遷移。
- リストが空の場合は fallback モックが表示される。

---

## 3. EDA Summary (`/eda/:datasetId`)

```
┌ Main ───────────────────────────────────────────────────────┐
│ [H1] EDA 概要                                              │
│ [Optional Banner] LLMフォールバック                        │
│ [Section] サマリー: 行数 / 列数 / 欠損率                   │
│ [Section] 主要な分布: 箇条書き                             │
│ [Section] 品質課題: severity + 説明                        │
│ [Section] 注目すべき特徴: 箇条書き                         │
│ [Section] 次アクション: 番号付きリスト (score/impact)      │
│ [View Toggle] 統計ビュー / 引用ビュー                       │
│   - 統計ビュー: 欠損率 / 課題数 / 提案数                   │
│   - 引用ビュー: kind:locator リスト (tool: は警告表示)      │
│ [Links] Charts / Q&A / Next Actions / PII / Leakage / Recipes│
└──────────────────────────────────────────────────────────┘
```

---

## 4. Charts（提案→生成→表示・一括生成）(`/charts/:datasetId`)

```
┌ Main ─────────────────────────────────────────────────────────────┐
│ [H1] チャート提案                                              │
│ [Toolbar] [Toggle] 一貫性≥0.95 のみ / すべて                    │
│           [Search? 省略]                                        │
│                                                                  │
│ [Selection Bar] （チェックが1件以上で表示）                      │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ 3件選択  [一括生成]  [キャンセル(灰色, P1)]              │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
│ Grid(1–2列): 提案カード each                                    │
│ ┌ Card ─────────────────────────────────────────────────────┐   │
│ │ type: Bar  [Confidence: 97%]                              │   │
│ │ explanation（1–2行）                                      │   │
│ │ 根拠: fig:monthly_sales                                   │   │
│ │ Diagnostics: trend / correlation / dominant_ratio         │   │
│ │ [□ 選択]                               [チャート作成]       │   │
│ │──────────────────────────────────────────────────────────│   │
│ │ 生成中（オーバーレイ）:                                     │   │
│ │  [準備]→[コード生成]→[実行]→[レンダリング] (ステップUI)     │   │
│ │ 成功時: タブ                                                  │   │
│ │  [可視化]（PNG|Vega） / [コード] / [メタ] / [ダウンロード] │   │
│ │  エラー: バナー + 「理由」 + [テンプレで生成] [再試行]     │   │
│ └──────────────────────────────────────────────────────────┘   │
│ ・・・                                                          │
└────────────────────────────────────────────────────────────┘
```

状態バリエーション（Story/VR対象）
- 標準（ConsistentOnly）: 高一貫性カードが並ぶ（Confidenceバッジ）。
- 空（Empty）: 「候補が見つかりません」メッセージ。
- 生成中: カード内にステップUI（準備→生成→実行→レンダリング）。
- 成功: タブ表示（可視化/コード/メタ/ダウンロード）。
- 失敗: 人間可読エラー（安全フィルタ/空応答/JSON不整合/実行失敗）＋フォールバック。

一括生成（CH-20/21）
```
┌ Selection Bar ──────────────────────────────┐
│ [3件選択]   進捗: 2/3 完了  [一括生成 実行中…] │
└───────────────────────────────────────────┘
カード：個別に「実行中/成功/失敗」を表示。失敗のみ [再試行] が活性。
```

---

## 5. Q&A (`/qna/:datasetId`)

```
┌ Main ───────────────────────────────────────────────────────┐
│ [H1] Q&A                                                   │
│ [Input] question (width:60%) [Button] 質問する             │
│ [Loading] 問い合わせ中... (optional)                      │
│ [Section] 回答: テキスト / coverage                        │
│ [Section] 引用一覧: kind: locator                          │
└──────────────────────────────────────────────────────────┘
```

---

## 6. Next Actions (`/actions/:datasetId`)

```
┌ Main ───────────────────────────────────────────────────────┐
│ [H1] Next Actions                                          │
│ [Optional Banner] LLMフォールバック                        │
│ [Ordered List] title + WSJF/RICE + 理由                     │
│ [View Toggle] 統計ビュー / 引用ビュー                       │
│   - 統計: 推定アクション数 / 入力候補数                     │
│   - 引用: kind: locator + tool: 表示                        │
└──────────────────────────────────────────────────────────┘
```

---

## 7. PII (`/pii/:datasetId`)

```
┌ Main ───────────────────────────────────────────────────────┐
│ [H1] PII スキャン                                          │
│ [Section] 検出フィールド: チェックボックス一覧             │
│ [Select] マスクポリシー (MASK/HASH/DROP)                   │
│ [Button] マスクを適用して再計算                            │
│ [Meta] 適用済み / 最終更新                                 │
└──────────────────────────────────────────────────────────┘
```

---

## 8. Leakage (`/leakage/:datasetId`)

```
┌ Main ───────────────────────────────────────────────────────┐
│ [H1] リーク検査                                            │
│ [Section] flagged_columns: チェックボックス                │
│ [Buttons] 除外 / 承認 / リセット (選択が無いと disabled)   │
│ [Meta] 除外済み / 承認済み / 検出ルール / 最終更新         │
└──────────────────────────────────────────────────────────┘
```

---

## 9. Recipes (`/recipes/:datasetId`)

```
┌ Main ───────────────────────────────────────────────────────┐
│ [H1] Recipes                                               │
│ [Optional Banner] LLMフォールバック                        │
│ [Optional Banner] ±1% 乖離警告                             │
│ artifact_hash                                               │
│ summary: rows / cols / missing_rate                         │
│ files: bullet list (名前 + サイズ)                         │
│ [View Toggle] 統計ビュー / 引用ビュー                       │
│   - 統計: measured_summary の数値                          │
│   - 引用: kind: locator                                    │
└──────────────────────────────────────────────────────────┘
```

---

## 10. Settings（LLM資格情報・プロバイダ切替）(`/settings`)

```
┌ Main ───────────────────────────────────────────────────────┐
│ [H1] システム設定                                          │
│ [Section] 使用中プロバイダ: OpenAI / Gemini（切替ボタン）   │
│ [Section] プロバイダ別ステータス: configured / unconfigured │
│ [Form]                                                      │
│  - Provider: (openai | gemini)                             │
│  - API Key: password input                                 │
│  - [保存]  （二重送信ガード/inFlight）                       │
│  - [プロバイダを切替]（キー再入力不要、即時反映）            │
│ 成功/エラー: トースト + 文言                                │
└──────────────────────────────────────────────────────────┘
```

---

## 11. バックログ要素 / 近接P1

- **アップロード UI**: Home にドラッグ&ドロップ領域を追加し、`POST /api/datasets/upload` と連携する。
- **Charts/Batch**: 進捗モーダル・全選択（表示中のみ/全件の選択範囲切替）、個別キャンセルの導線。
- **ナビゲーション強調**: 現在地ハイライト、Breadcrumbs を追加。
- **共通カード/リスト化**: EDA/Actions/Recipes のセクションを再利用可能なコンポーネントへ抽出。
- **レスポンシブ対応**: 固定幅からフレックスレイアウトへ改善。

---

## 12. Storybook / VR 紐付け（運用）

- Foundation/UI/Pages の各ワイヤーに対し、対応する Story を用意（Docsを含む）。
- Charts 代表: `Pages/ChartsPage: ConsistentOnly / Empty` をVR対象（Linuxベースライン）。
- preview.ts でモーション/フォント/日時を固定しブレを抑制。差分は `maxDiffPixelRatio` 0.01–0.03。
- 失敗時はレポート（HTML）をアーティファクト化。意図したUI変更のみベースライン更新。

実装更新時は本ワイヤーフレームを差し替え、Storybook と整合させること。
